// your-discord-bot/events/messageCreate.js
const affectionManager = require('../utils/affectionManager'); // å¼•å…¥å¥½æ„Ÿåº¦ç®¡ç†æ¨¡çµ„

// ç›´æŽ¥å°Žå‡ºä¸€å€‹ç•°æ­¥å‡½æ•¸
// é€™å€‹å‡½æ•¸çš„åƒæ•¸æœƒç”± client.on å‚³å…¥ï¼Œé€šå¸¸ç¬¬ä¸€å€‹æ˜¯ client ç‰©ä»¶æœ¬èº«ï¼Œå¾Œé¢æ˜¯äº‹ä»¶çš„åƒæ•¸
// å°æ–¼ messageCreate äº‹ä»¶ï¼Œå®ƒçš„åƒæ•¸æ˜¯ (message)
// ä½†ç”±æ–¼æ‚¨åœ¨ bot.js ä¸­ä½¿ç”¨äº† event.bind(null, client)ï¼Œé€™æœƒæŠŠ client ç¶å®šç‚ºç¬¬ä¸€å€‹åƒæ•¸
// æ‰€ä»¥é€™è£¡éœ€è¦æŽ¥æ”¶ (client, message)
module.exports = async (client, message) => { // æ³¨æ„é€™è£¡æŽ¥æ”¶ client å’Œ message
    if (message.author.bot) return; // å¿½ç•¥æ©Ÿå™¨äººè‡ªå·±çš„è¨Šæ¯

    const userId = message.author.id;

    if (message.content.toLowerCase().includes('æ—©ä¸Šå¥½åŸºåœ°')) {
        // å…ˆæª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²ç¶“å•å€™éŽ
        if (affectionManager.hasGreetedToday(userId)) {
            await message.reply(`${message.author.username}ï¼Œä½ ä»Šå¤©å·²ç¶“å‘åŸºåœ°å•å€™éŽäº†ã€‚å­¸è¡“ç³¾ç´›æ©Ÿå™¨äººæé†’ä½ ï¼Œé‡è¤‡çš„è¡Œç‚ºä¸å€¼å¾—é¡å¤–é—œæ³¨ã€‚`);
            return; // çµ‚æ­¢å‡½æ•¸åŸ·è¡Œ
        }

        // å¦‚æžœä»Šå¤©æ²’å•å€™éŽï¼Œæ‰å¢žåŠ å¥½æ„Ÿåº¦
        // æ³¨æ„é€™è£¡ä½¿ç”¨äº† awaitï¼Œå› ç‚º addAffection æ˜¯ä¸€å€‹ç•°æ­¥å‡½æ•¸
        const currentAffection = await affectionManager.addAffection(userId, 1);

        // å¦‚æžœ addAffection è¿”å›ž false (è¡¨ç¤ºä»Šå¤©å·²ç¶“è§¸ç™¼ï¼Œä½†å› ä¹‹å‰æ²’æœ‰æª¢æŸ¥è€Œé€²å…¥é€™è£¡)
        // é›–ç„¶ç†è«–ä¸Šè¢«ä¸Šé¢çš„ hasGreetedToday() æ“‹ä½äº†ï¼Œä½†é€™æ˜¯å€‹é¡å¤–çš„é˜²ç¦¦æ€§æª¢æŸ¥
        if (currentAffection === false) {
             await message.reply(`${message.author.username}ï¼Œä½ ä»Šå¤©å·²ç¶“å‘åŸºåœ°å•å€™éŽäº†ã€‚æé†’ä½ ï¼Œé‡è¤‡çš„è¡Œç‚ºä¸å€¼å¾—é¡å¤–é—œæ³¨ðŸ“`);
             return;
        }

        let replyMessage = '';
        if (currentAffection >= 1 && currentAffection <= 25) {
            // å¥½æ„Ÿåº¦ 1-25ï¼šå‹™å¯¦ã€ç›´æŽ¥ï¼Œå¸¶è‘—åˆå§‹çš„å£“è¿«æ„Ÿï¼Œè¦ªå¯†æ„Ÿæ˜¯æ›´ç›´æŽ¥çš„ã€Œç³¾æ­£ã€ï¼Œç•æ‡¼æ„Ÿæ˜¯ã€Œæ½›åœ¨çš„è­¦å‘Šã€ï¼Œå¥½ç¬‘æ˜¯ã€Œå†·æ¼ çš„å˜²è«·ã€
            const greetings = [
                "çœ‹ä¾†ä½ é‚„æ²’ç™¼ç˜‹ï¼Œé€™æ˜¯å€‹å¥½é–‹å§‹ã€‚ç¾åœ¨ï¼ŒæŠŠé‚£ä»½å ±å‘Šçš„éŒ¯èª¤ä¿®æ­£ä¸€ä¸‹ã€‚",
                "é›–ç„¶å®‡å®™çµ‚å°‡æ­¸æ–¼è™›ç„¡ï¼Œä½†ä½ çš„æ–‡ä»¶å¤¾ç‚ºä»€éº¼é‚„æ˜¯é€™éº¼äº‚ï¼Ÿ",
                "åˆ¥æµªè²»æˆ‘çš„æ™‚é–“ï¼Œä½ çš„ä»»å‹™æ¸…å–®é‚„æ²’å®Œæˆå‘¢ã€‚",
                "ä½ æœ€å¥½ç¢ºèªæ‰€æœ‰æ¨™é»žç¬¦è™Ÿéƒ½æ²’éŒ¯ã€‚æˆ‘å¯ä¸å–œæ­¡é‡è¤‡æé†’ã€‚",
                "åˆ¥æŒ‡æœ›æˆ‘æœƒç¨±è®šä½ çš„åŠªåŠ›ï¼Œæˆ‘åªçœ‹åˆ°ä½ æœªå®Œæˆçš„ä»»å‹™ã€‚é€™å¾ˆæœ‰è¶£ï¼Œä¸æ˜¯å—Žï¼Ÿ" // æ–°å¢žçš„ã€Œå¥½ç¬‘ã€å•å€™
            ];
            replyMessage = greetings[Math.floor(Math.random() * greetings.length)];
        } else if (currentAffection >= 26 && currentAffection <= 50) {
            // å¥½æ„Ÿåº¦ 26-50ï¼šé–‹å§‹å¸¶æœ‰å°æ··äº‚çš„ä¸æ»¿ï¼Œä»¥åŠå°æ•ˆçŽ‡çš„å¼·èª¿ï¼Œè¦ªå¯†æ„Ÿæ˜¯æ›´é‡å°æ€§çš„ã€ŒæŒ‡å°Žã€ï¼Œç•æ‡¼æ„Ÿæ˜¯ã€Œå°éŒ¯èª¤çš„å¯©åˆ¤ã€ï¼Œå¥½ç¬‘æ˜¯ã€Œç„¡æƒ…çš„ç¾å¯¦é™³è¿°ã€
            const greetings = [
                "åˆ¥è·Ÿæˆ‘èªªä½ çš„Sanå€¼ä¸å¤ ã€‚æŠŠæ‰‹é ­è©²åšçš„äº‹æƒ…åšå®Œï¼Œåˆ¥æ‹–åˆ°èˆŠæ—¥æ”¯é…è€…ç”¦é†’é‚£å¤©ã€‚",
                "æˆ‘ä¸åœ¨ä¹Žä½ æ˜¨å¤©åœ¨æ‹‰èŠè€¶åšäº†ä»€éº¼å¤¢ï¼Œæˆ‘åªåœ¨ä¹Žä½ ä»Šå¤©çš„å·¥ä½œé€²åº¦ã€‚",
                "æ··æ²Œä¹‹ä¸­ä¹Ÿéœ€è¦ç§©åºï¼Œå°¤å…¶æ˜¯ä½ é‚£æ··äº‚çš„å¼•ç”¨æ ¼å¼ã€‚",
                "æˆ‘è§€å¯Ÿä½ ä¸€é™£å­äº†ï¼Œæœ‰äº›å•é¡Œå¿…é ˆç¾åœ¨è§£æ±ºï¼Œè€Œä¸æ˜¯ç­‰åˆ°ä¸–ç•Œæ¯€æ»…ã€‚",
                "ä½ ä»¥ç‚ºæˆ‘æ²’æ³¨æ„åˆ°ä½ è«–æ–‡è£¡çš„é‚è¼¯æ¼æ´žå—Žï¼Ÿå®ƒå€‘æ¯”æ·±æ·µæ›´æ˜Žé¡¯ã€‚",
                "ä½ çš„æ‹–å»¶ç—‡æ¯”å¤–ç¥žçš„å­˜åœ¨æ›´æœ‰è¦å¾‹ã€‚é€™å€¼å¾—å­¸è¡“ç ”ç©¶ã€‚" // æ–°å¢žçš„ã€Œå¥½ç¬‘ã€å•å€™
            ];
            replyMessage = greetings[Math.floor(Math.random() * greetings.length)];
        } else if (currentAffection >= 51 && currentAffection <= 75) {
            // å¥½æ„Ÿåº¦ 51-75ï¼šèªžæ°£ä¸­å¸¶æœ‰æ›´å¤šçš„ã€Œå¿ å‘Šã€èˆ‡å°äººé¡žæŽ™æ‰Žçš„è§€å¯Ÿï¼Œè¦ªå¯†æ„Ÿæ˜¯æ›´æ·±å±¤çš„ã€Œæé†’ã€ï¼Œç•æ‡¼æ„Ÿæ˜¯ã€Œç„¡æ³•é€ƒè„«çš„æŽŒæŽ§ã€ï¼Œå¥½ç¬‘æ˜¯ã€Œå°ç„¡åŠ›æ„Ÿçš„è«·åˆºã€
            const greetings = [
                "ä½ ä»¥ç‚ºç†è§£äº†å…‹è˜‡é­¯çš„ä½Žèªžå°±èƒ½é€ƒé¿ç¾å¯¦ï¼ŸæŠŠæ³¨æ„åŠ›æ”¾å›žçœ¼å‰ï¼Œæ•ˆçŽ‡æ‰æ˜¯ç¡¬é“ç†ã€‚",
                "åœ¨é€™äº›ä¸å¯åç‹€çš„ææ€–é¢å‰ï¼Œè‡³å°‘ä½ çš„æ™‚é–“ç®¡ç†å¯ä»¥ä¸é‚£éº¼ææ€–ï¼Œå°å§ã€‚",
                "ä½ èŠ±åœ¨ç ”ç©¶ç¦å¿ŒçŸ¥è­˜çš„æ™‚é–“ï¼Œå¦‚æžœç”¨ä¾†æ•´ç†æª”æ¡ˆï¼Œå®‡å®™éƒ½èƒ½å¤šå­˜åœ¨å¹¾ç§’é˜ã€‚",
                "å¦‚æžœä½ çœŸçš„æƒ³åœ¨ç„¡ç›¡çš„è™›ç©ºä¸­æœ‰æ‰€ä½œç‚ºï¼Œè«‹å…ˆè­‰æ˜Žä½ çš„åŸºæœ¬èƒ½åŠ›ã€‚",
                "æˆ‘ç„¡æ™‚ç„¡åˆ»ä¸åœ¨å¯©è¦–è‘—ä½ çš„å­¸è¡“è¡Œç‚ºã€‚ä»»ä½•åå·®éƒ½é€ƒä¸éŽæˆ‘çš„çœ¼ç›ã€‚",
                "ä½ å°å­¸è¡“è‡ªç”±çš„ç†è§£ï¼Œå°±åƒäººé¡žå°æ˜Ÿéš›æ—…è¡Œçš„å¹»æƒ³ä¸€æ¨£ã€‚å¤©çœŸå¾—å¯ç¬‘ã€‚" // æ–°å¢žçš„ã€Œå¥½ç¬‘ã€å•å€™
            ];
            replyMessage = greetings[Math.floor(Math.random() * greetings.length)];
        } else if (currentAffection >= 76 && currentAffection <= 100) {
            // å¥½æ„Ÿåº¦ 76-100ï¼šèªžæ°£æ›´ã€Œè²¼è¿‘ã€ï¼Œä½†ä¾ç„¶æ˜¯å…‹è˜‡é­¯å¼çš„è’è¬¬å’Œç¾å¯¦ä¸»ç¾©ï¼Œè¦ªå¯†æ„Ÿæ˜¯å¸¶æœ‰å€‹äººè‰²å½©çš„ã€ŒæœŸå¾…ã€ï¼Œç•æ‡¼æ„Ÿæ˜¯ã€Œæ½›æ„è­˜çš„å£“åŠ›ã€ï¼Œå¥½ç¬‘æ˜¯ã€Œè¢«æ‰­æ›²çš„è®šæšã€
            const greetings = [
                "æ¯”èµ·é‚£äº›è •å‹•çš„è™›ç©ºä¹‹ç‰©ï¼Œæˆ‘æ›´æ“”å¿ƒä½ æ²’æœ‰æŒ‰ç…§è¦ç¯„å®Œæˆä»»å‹™ã€‚",
                "æˆ‘çŸ¥é“é‚£è²éŸ³åœ¨å¬å–šä½ ï¼Œä½†åœ¨ä½ å®Œå…¨è¢«æ‰­æ›²ä¹‹å‰ï¼Œè‡³å°‘æŠŠé€™ä»½æ–‡ä»¶ç°½å­—ã€‚",
                "ä½ å¾ˆé›£å¾—åœ°æ²’è®“æˆ‘å¤±æœ›ã€‚è¨˜ä½ï¼Œå„ªç§€çš„ç§©åºæ‰æ˜¯é€šå¾€æ·±æ·µçš„å”¯ä¸€é“è·¯ã€‚",
                "å³ä½¿ä½ å¿˜è¨˜äº†æ‰€æœ‰å’’èªžï¼Œä½ ä¹Ÿä¸è©²å¿˜è¨˜æˆ‘å°ä½ çš„æœŸæœ›ã€‚é‚£å°‡æ˜¯æœ€çµ‚çš„éŒ¯èª¤ã€‚",
                "çœ‹åˆ°ä½ çµ‚æ–¼å­¸æœƒäº†åŸºæœ¬è¦ç¯„ï¼Œæˆ‘å¿ƒä¸­æ„Ÿå—åˆ°äº†ï¼Œå—¯ï¼Œä¸€ç¨®ç•°æ–¼æ··æ²Œçš„å¯§éœã€‚æŒºæ»‘ç¨½çš„ã€‚" // æ–°å¢žçš„ã€Œå¥½ç¬‘ã€å•å€™
            ];
            replyMessage = greetings[Math.floor(Math.random() * greetings.length)];
        } else {
            // å¥½æ„Ÿåº¦è¶…éŽ100æˆ–å…¶ä»–æƒ…æ³çš„å‚™ç”¨å›žæ‡‰
            replyMessage = `æ—©ä¸Šå¥½åŸºåœ°ï¼${message.author.username}ï¼Œä½ ä»Šå¤©çš„å­¸è¡“ç²¾ç¥žä¾ç„¶å…‰èŠ’è¬ä¸ˆã€‚å¥½æ„Ÿåº¦ï¼š${currentAffection}ã€‚`;
        }
        await message.reply(replyMessage);
    }
};
